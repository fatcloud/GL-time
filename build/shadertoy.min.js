/**
 * @author: Andre Venancio [andre@lowwwltd.com]
 * version: 0.0.5 [2015-11-24]
 */
var ShaderToy=function(){window.WebGLRenderingContext?this.init():console.error("You need a WebGL browser: Try get.webgl.org")};ShaderToy.prototype={constructor:ShaderToy.prototype,version:"0.0.5",mouse:new Float32Array(2),textures:[],width:320,height:240,_ready:!1,_pause:!1,_vertexShader:["attribute vec2 position;","void main() {","   gl_Position = vec4( position, 0.0, 1.0 );","}"],_fragmentShader:["precision highp float;","uniform float iGlobalTime;","uniform vec2 iResolution;","uniform vec2 iMouse;","uniform sampler2D iChannel0;","uniform sampler2D iChannel1;","uniform sampler2D iChannel2;","uniform sampler2D iChannel3;","void mainImage( out vec4 fragColor, in vec2 fragCoord ) { fragColor.rgb = vec3( 0.5 + 0.5 * cos( iGlobalTime ) ); }","void main() {","   vec4 color = vec4( 0.0, 0.0, 0.0, 1.0 );","   mainImage( color, gl_FragCoord.xy );","   gl_FragColor = color;","}"],_loadExternalFile:function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b(d.response):c(Error(d.statusText))},d.onerror=function(){c(Error("Network Error"))},d.send()})},_createProgram:function(a,b){var c=this._createShader(a,this.gl.VERTEX_SHADER),d=this._createShader(b,this.gl.FRAGMENT_SHADER),e=this.gl.createProgram();return this.gl.attachShader(e,c),this.gl.attachShader(e,d),this.gl.linkProgram(e),e},_createShader:function(a,b){var c=this.gl.createShader(b);this.gl.shaderSource(c,a),this.gl.compileShader(c);var d=this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS);if(!d){var e=this.gl.getShaderInfoLog(c);return console.error("Error compiling shader",c,e),this.gl.deleteShader(c),null}return c},_createTexture:function(a){this.gl.activeTexture(this.gl.TEXTURE0+a);var b=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,b),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,255,255,255])),b},_updateTexture:function(a,b){this.textures[b]?(this.gl.deleteTexture(this.textures[b]),delete this.textures[b],this._updateTexture(a,b)):(this.textures[b]=this._createTexture(b),this.gl.activeTexture(this.gl.TEXTURE0+b),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[b]),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this._isPowerOf2(a.width)&&this._isPowerOf2(a.height)?this.gl.generateMipmap(this.gl.TEXTURE_2D):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR)))},_getUniform:function(a){return this.program.uniforms||(this.program.uniforms={}),this.program.uniforms[a]||(this.program.uniforms[a]=this.gl.getUniformLocation(this.program,a)),this.program.uniforms[a]},_getAttribute:function(a){return this.program.atttributes||(this.program.atttributes={}),this.program.atttributes[a]||(this.program.atttributes[a]=this.gl.getAttribLocation(this.program,a)),this.program.atttributes[a]},_setU1f:function(a,b){this.gl.uniform1f(this._getUniform(a),b)},_setU2f:function(a,b,c){this.gl.uniform2f(this._getUniform(a),b,c)},_setU2fv:function(a,b){this.gl.uniform2fv(this._getUniform(a),b)},_setU1i:function(a,b){this.gl.uniform1i(this._getUniform(a),b)},_onBlur:function(a){this._pause=!0},_onFocus:function(a){this._pause=!1},_onMove:function(a){this.mouse[0]=a.layerX,this.mouse[1]=a.layerY},_isPowerOf2:function(a){return 0===(a&a-1)},init:function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height,document.body.appendChild(a),window.addEventListener("blur",this._onBlur.bind(this)),window.addEventListener("focus",this._onFocus.bind(this)),window.addEventListener("mousemove",this._onMove.bind(this)),this.gl=a.getContext("webgl"),this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_standard_derivatives"),this.gl.getExtension("OES_float_linear"),this.gl.getExtension("OES_half_float_linear"),this.gl||console.error("Couldn't start WebGL. Try get.webgl.org/troubleshooting");var b=["\n%cShader%cToy%c v: "+this.version+"\n","background: #1A1A1A; color: #00ffff; font-size: x-large;","background: #00ffff; color: #1A1A1A; font-size: x-large;","background: transparent; color: #000000; font-size: x-small;"];window.shadertoycredits||(window.shadertoycredits=!0,console.log.apply(console,b));var c=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),d=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,d),this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.STATIC_DRAW);var e=this._createProgram(this._vertexShader.join("\n"),this._fragmentShader.join("\n"));this.useProgram(e)},loadFragment:function(a){this._ready=!1,this._loadExternalFile(a).then(function(a){this.writeFragment(a)}.bind(this))},loadImage:function(a,b){var c=this,d=new Image;d.src=a,d.index=b||0,d.onload=function(){c._updateTexture(d,this.index)}},writeFragment:function(a){this._ready=!1,this._fragmentShader[8]=a;var b=this._createProgram(this._vertexShader.join("\n"),this._fragmentShader.join("\n"));this.useProgram(b)},useProgram:function(a){this.program=a,this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this._getAttribute("position")),this.gl.vertexAttribPointer(this._getAttribute("position"),2,this.gl.FLOAT,!1,0,0),this._setU2f("iResolution",this.width,this.height),this.startTime=Date.now(),this._ready=!0},setSize:function(a,b){this.width=a,this.height=b,this.gl.canvas.width=this.width,this.gl.canvas.height=this.height,this.gl.viewportWidth=this.width,this.gl.viewportHeight=this.height,this.gl.viewport(0,0,this.width,this.height),this.program&&this._setU2f("iResolution",this.width,this.height)},clear:function(a,b,c,d){this.gl.clearColor(a||0,b||0,c||0,d||1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},render:function(){this._ready===!0&&(this._pause||(this._setU1f("iGlobalTime",(Date.now()-this.startTime)/1e3),this._setU2fv("iMouse",this.mouse),this._setU1i("iChannel0",0),this._setU1i("iChannel1",1),this._setU1i("iChannel2",2),this._setU1i("iChannel3",3),this.clear(),this.gl.drawArrays(this.gl.TRIANGLES,0,6)))}};